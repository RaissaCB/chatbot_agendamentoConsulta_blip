{"flow":{"onboarding":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"a466c3c4-c090-4d3e-b38a-3cde8c77af94","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":false,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"welcome","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"b12c67af-aca3-4f6c-aa07-9275e346a1b8","$connId":"con_3","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"onboarding","root":true,"$title":"Início","$position":{"top":"120px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"fallback":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"568ce597-16ce-4ebb-a444-a535ece51f9e","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"error","conditions":[{"source":"input","comparison":"matches","values":[".*"]}],"$id":"aebdb583-641f-4c5f-ac89-65e39dd1e933","$connId":"con_8","$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false},"$tags":[],"id":"fallback","$title":"Exceções","$position":{"top":"106.667px","left":"1293.67px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"welcome":{"$contentActions":[{"action":{"$id":"a8b59ae7-3045-449e-95aa-d3ad217b3813","$typeOfContent":"select","type":"SendMessage","settings":{"id":"894eafd3-5601-4827-bd57-1e458b94e410","type":"application/vnd.lime.select+json","content":{"text":"Olá! Seja bem vindo (a)! O que deseja fazer?","options":[{"text":"Agendar consulta","previewText":"Agendar consulta","value":null,"index":0,"type":null},{"text":"Informação de áreas médicas","previewText":"Informação de áreas médicas","value":null,"index":1,"type":null},{"index":2,"text":"Falar com atendente humano","previewText":"Falar com atendente humano","type":null,"value":null}]},"metadata":{}},"$cardContent":{"document":{"id":"894eafd3-5601-4827-bd57-1e458b94e410","type":"application/vnd.lime.select+json","content":{"text":"Olá! Seja bem vindo (a)! O que deseja fazer?","options":[{"text":"Agendar consulta","previewText":"Agendar consulta","value":null,"index":0,"type":null},{"text":"Informação de áreas médicas","previewText":"Informação de áreas médicas","value":null,"index":1,"type":null},{"index":2,"text":"Falar com atendente humano","previewText":"Falar com atendente humano","type":null,"value":null}]}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"b9c14524-bf48-481c-af99-9ef41b0df56b","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"90f26382-c363-46f6-ae99-cc088d084c47","typeOfStateId":"state","$connId":"con_13","$id":"1a61133e-c011-4920-8b38-4d20d7e4eb58","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"input.contentAssistant.name"}],"$invalid":false},{"stateId":"3ebaac25-8e40-4394-98f2-964789345758","typeOfStateId":"state","$connId":"con_18","$id":"8798d292-bd46-4ff5-bfcc-68c5973c1793","conditions":[{"source":"intent","comparison":"equals","values":["agendamento"]}],"$invalid":false},{"stateId":"cd9612be-7264-4f80-9275-478b6bbefd0e","typeOfStateId":"state","$connId":"con_23","$id":"14f84062-60d1-4b90-8475-1df38c12b58e","conditions":[{"source":"intent","comparison":"equals","values":["Falar com um atendente"]}],"$invalid":false},{"stateId":"3ebaac25-8e40-4394-98f2-964789345758","typeOfStateId":"state","$connId":"con_28","$id":"e4a1fa6d-6f7a-4531-b702-a75c096fbcd7","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"validaCPF"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"2b67785a-136a-43bf-91c9-0228df764492","$typeOfContent":"","type":"ExecuteScript","$title":"Valida CPF","$invalid":false,"settings":{"function":"run","source":"function run(cpf) {\n    \n    const isCPF = (cpf) => {\n        if (!cpf) return cpf\n        cpf = cpf.replace(/\\D/g, '')\n        if (cpf === '') return false\n        if (\n            cpf.length !== 11 ||\n            cpf === '00000000000' ||\n            cpf === '11111111111' ||\n            cpf === '22222222222' ||\n            cpf === '33333333333' ||\n            cpf === '44444444444' ||\n            cpf === '55555555555' ||\n            cpf === '66666666666' ||\n            cpf === '77777777777' ||\n            cpf === '88888888888' ||\n            cpf === '99999999999'\n        )\n            return false\n        var add = 0\n        for (var i = 0; i < 9; i++) add += parseInt(cpf.charAt(i)) * (10 - i)\n        var rev = 11 - (add % 11)\n        if (rev === 10 || rev === 11) rev = 0\n        if (rev !== parseInt(cpf.charAt(9))) return false\n        add = 0\n        for (i = 0; i < 10; i++) add += parseInt(cpf.charAt(i)) * (11 - i)\n        rev = 11 - (add % 11)\n        if (rev === 10 || rev === 11) rev = 0\n        if (rev !== parseInt(cpf.charAt(10))) return false\n        return true\n    }\n\n    const validaCPF = (cpf = null) => {\n      if (!cpf) return false\n      cpf = cpf.replace(/\\D/g, '')\n      return  cpf.length === 11 ? isCPF(cpf)\n        : false\n    }\n    \n    return JSON.stringify(validaCPF(cpf));\n}","inputVariables":[],"outputVariable":"validaCPF"},"conditions":[]}],"$inputSuggestions":["Agendar consulta","Informação de áreas médicas","Falar com atendente humano"],"$defaultOutput":{"stateId":"fallback","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"welcome","$title":"Boas vindas","$position":{"top":"275px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"error":{"$contentActions":[{"action":{"$id":"584d0571-4b47-4f63-a292-49feb29445fc","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000002","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"action":{"$id":"fa9a6e4e-212f-4d27-b6a9-7064b3cb54e2","$typeOfContent":"","type":"SendMessage","settings":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"$cardContent":{"document":{"id":"00000000-0000-0000-0000-000000000003","type":"text/plain","content":"Desculpe, não consegui entender!"},"editable":true,"deletable":true,"position":"left","editing":false}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"3781da0f-d952-4e07-a39d-b261feb15255","type":"text/plain","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"error","$title":"Erro padrão","$position":{"top":"241.797px","left":"1293.73px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"faf92b80-6f55-4f1f-8deb-9cf13ca7b24b":{"$contentActions":[{"action":{"$id":"cadcbbe8-e719-4185-aabe-27283149b93d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"364f7949-34c9-43f9-bfec-a638c8437889","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"364f7949-34c9-43f9-bfec-a638c8437889","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"1c0a0276-c015-49a5-8356-c7117cc5a12d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a3e6ee6c-e809-423b-9e32-37cffbca74f2","type":"text/plain","content":"O consultório de atendimento será o mais proxima da rua {{resposta@logradouro}} da cidade {{resposta@localidade}}","metadata":{}},"$cardContent":{"document":{"id":"a3e6ee6c-e809-423b-9e32-37cffbca74f2","type":"text/plain","content":"O consultório de atendimento será o mais proxima da rua {{resposta@logradouro}} da cidade {{resposta@localidade}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"ef4b76db-2354-497a-98a0-98487259d024","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"41555850-4336-4e9c-8182-14ab257c7680","$typeOfContent":"","type":"ProcessHttp","$title":"Requisição HTTP","$invalid":false,"settings":{"headers":{},"method":"GET","uri":"https://viacep.com.br/ws/{{cep}}/json/","responseBodyVariable":"resposta","responseStatusVariable":"status"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"e8c24fb2-e89c-41e6-a36c-9f1487aacca2","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"faf92b80-6f55-4f1f-8deb-9cf13ca7b24b","root":false,"$title":"Dados","$position":{"top":"602.667px","left":"209px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e8c24fb2-e89c-41e6-a36c-9f1487aacca2":{"$contentActions":[{"action":{"$id":"ef19c937-d97f-4158-9801-0cf15fc590bd","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"12b6b1b4-56f8-43ce-8592-0503ccf1f2ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"12b6b1b4-56f8-43ce-8592-0503ccf1f2ab","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"864fedcf-e429-4328-83c1-c165d0ba6043","$typeOfContent":"text","type":"SendMessage","settings":{"id":"897f73fa-7b0a-45ce-bff0-fca42920dd5d","type":"text/plain","content":"Qual o CPF do paciente?","metadata":{}},"$cardContent":{"document":{"id":"897f73fa-7b0a-45ce-bff0-fca42920dd5d","type":"text/plain","content":"Qual o CPF do paciente?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"bde147a7-eb4c-413b-8274-cdce2daf614e","type":"text/plain","textContent":"Entrada do usuário","content":"cpf"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"cpf","validation":{"rule":"regex","error":"CPF inválido. Insira como no ex: 000.000.000-00","regex":"^\\d{3}.?\\d{3}.?\\d{3}-?\\d{2}$"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"31dbd652-d8fc-4ed9-a9f8-fdfa71ac5013","typeOfStateId":"state","$connId":"con_33","$id":"81d9bc0c-abf5-4c4e-b12c-02b115679a6a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.cpf"}],"$invalid":false},{"stateId":"31dbd652-d8fc-4ed9-a9f8-fdfa71ac5013","typeOfStateId":"state","$connId":"con_38","$id":"8a8cdfcd-d5d2-4057-b082-6b09716634f1","conditions":[{"source":"input","comparison":"exists","values":[],"variable":"cpf"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"a1759ece-a3a8-4c3e-9708-a6b485d8b56c","$typeOfContent":"","type":"MergeContact","$title":"Definir contato CPF","$invalid":false,"settings":{"extras":{},"taxDocument":"{{cpf}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"e8c24fb2-e89c-41e6-a36c-9f1487aacca2","root":false,"$title":"CPF","$position":{"top":"481px","left":"426px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"31dbd652-d8fc-4ed9-a9f8-fdfa71ac5013":{"$contentActions":[{"action":{"$id":"ea63ab06-2ec7-4f97-a72d-478f69398f8d","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"a1e1b335-8417-4eed-b63b-06b7f9f0b925","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"a1e1b335-8417-4eed-b63b-06b7f9f0b925","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"a1779d81-f90f-427d-b9ac-3381c45c7e8c","$typeOfContent":"text","type":"SendMessage","settings":{"id":"65b38277-7039-4e2e-9527-96bfab27d39a","type":"text/plain","content":"Informe seu telefone","metadata":{}},"$cardContent":{"document":{"id":"65b38277-7039-4e2e-9527-96bfab27d39a","type":"text/plain","content":"Informe seu telefone"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"1fead592-38f2-4b1d-8302-fe6c19419e7e","type":"text/plain","textContent":"Entrada do usuário","content":"telefone"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"telefone","validation":{"rule":"regex","regex":"^[1-9]{2}-[2-9][0-9]{7,8}$","error":"Telefone inválido. Insira o DDD - número do telefone"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"f74af6ff-a2aa-47b7-b8cf-25c20c43c708","typeOfStateId":"state","$connId":"con_43","$id":"1444d403-6d3b-49d0-ab4c-73c0303c3a15","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.phoneNumber"}],"$invalid":false},{"stateId":"f74af6ff-a2aa-47b7-b8cf-25c20c43c708","typeOfStateId":"state","$connId":"con_48","$id":"2e653891-e3a5-4f65-be27-b71d6c4f8e8b","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d6cce3b5-ece8-4a5d-bc3e-500f2a70984e","$typeOfContent":"","type":"MergeContact","$title":"Definir contato TELEFONE","$invalid":false,"settings":{"extras":{},"phoneNumber":"{{phoneNumber}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"31dbd652-d8fc-4ed9-a9f8-fdfa71ac5013","root":false,"$title":"Telefone","$position":{"top":"597px","left":"426px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f74af6ff-a2aa-47b7-b8cf-25c20c43c708":{"$contentActions":[{"action":{"$id":"79483f66-634c-45e8-a9ff-2c80fda3613e","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c1b8a00f-8b40-4bea-9221-28c3d9469f4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c1b8a00f-8b40-4bea-9221-28c3d9469f4d","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"172b7317-a1af-47b4-900a-ab1efc47455e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"97b0504c-e83f-4061-ba8d-49f6ec7c36af","type":"text/plain","content":"Qual o e-mail?","metadata":{}},"$cardContent":{"document":{"id":"97b0504c-e83f-4061-ba8d-49f6ec7c36af","type":"text/plain","content":"Qual o e-mail?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"2348da7f-c53a-4b58-ae29-500d71dfc144","type":"text/plain","textContent":"Entrada do usuário","content":"email"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"email","validation":{"rule":"regex","regex":"^([\\w.-]+)@([\\w-]+)((.(\\w){2,3})+)$","error":"E-mail inválido"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"92e034eb-9420-47ad-a10d-42519dffb045","typeOfStateId":"state","$connId":"con_53","$id":"7c5b6909-2427-42c2-b6b2-a8a8678b8616","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.email"}],"$invalid":false},{"stateId":"92e034eb-9420-47ad-a10d-42519dffb045","typeOfStateId":"state","$connId":"con_58","$id":"cb997a62-7785-47d6-99ef-98a9350aabc1","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"d0ce6476-1766-4281-b421-7f5f879422b1","$typeOfContent":"","type":"MergeContact","$title":"Definir contato EMAIL","$invalid":false,"settings":{"extras":{},"email":"{{email}}"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"f74af6ff-a2aa-47b7-b8cf-25c20c43c708","root":false,"$title":"E-mail","$position":{"top":"713px","left":"426px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b39ed2ce-c621-4fa0-b30c-0d885ac4e551":{"$contentActions":[{"action":{"$id":"d077e4a3-851e-4ec7-aed8-864fa8a0dd50","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"476dba73-b8fb-425f-b8b7-5ddb492a9339","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"476dba73-b8fb-425f-b8b7-5ddb492a9339","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"de6428a4-77f2-401e-b48f-932953a83013","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2cce5fab-4f03-4879-901c-1e783c3e84be","type":"text/plain","content":"Seu agendamento foi realizado com sucesso para a data {{date}} às {{time}}h. Verifique sua caixa de email {{contact.email}}, para saber mais informações do dia e horário da sua consulta. ","metadata":{}},"$cardContent":{"document":{"id":"2cce5fab-4f03-4879-901c-1e783c3e84be","type":"text/plain","content":"Seu agendamento foi realizado com sucesso para a data {{date}} às {{time}}h. Verifique sua caixa de email {{contact.email}}, para saber mais informações do dia e horário da sua consulta. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"523507c7-8b18-410b-9d3b-d4a195154a1b","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"c5b14d0b-143e-4f15-a632-026537eca215","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"c5b14d0b-143e-4f15-a632-026537eca215","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"202d1798-aa2a-427f-b96d-4cf46ff9ae43","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a91fbfc5-7522-4d54-8ff4-296483e547ac","type":"text/plain","content":"Qualquer coisa só chamar!","metadata":{}},"$cardContent":{"document":{"id":"a91fbfc5-7522-4d54-8ff4-296483e547ac","type":"text/plain","content":"Qualquer coisa só chamar!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"533cb84d-55ad-4c5f-9205-911ca3b8e801","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"welcome","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"b39ed2ce-c621-4fa0-b30c-0d885ac4e551","root":false,"$title":"Finalização","$position":{"top":"1044px","left":"433px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"3ebaac25-8e40-4394-98f2-964789345758":{"$contentActions":[{"action":{"$id":"22225c64-095a-4fb3-985b-a2c57078dab0","$typeOfContent":"text","type":"SendMessage","settings":{"id":"c45a859d-65d6-40e3-8605-c01b40ef935b","type":"text/plain","content":"Para agendar consulta é preciso o número do CPF do paciente, telefone de contato e o e-mail.","metadata":{}},"$cardContent":{"document":{"id":"c45a859d-65d6-40e3-8605-c01b40ef935b","type":"text/plain","content":"Para agendar consulta é preciso o número do CPF do paciente, telefone de contato e o e-mail."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"1936b1ab-94a1-4e07-b7a9-0a18d38d69aa","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1a2c749b-a378-4052-a901-e09c5ae26f23","$typeOfContent":"","type":"TrackEvent","$title":"Opcao1","$invalid":false,"settings":{"extras":{},"category":"listaOpcoes","action":"opcao1"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"f9f808e4-d40b-44f1-a3b0-8aacc53d25cb","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"3ebaac25-8e40-4394-98f2-964789345758","root":false,"$title":"Agendar Consulta","$position":{"top":"377px","left":"210px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"f9f808e4-d40b-44f1-a3b0-8aacc53d25cb":{"$contentActions":[{"action":{"$id":"fadfa062-9440-4ddd-a3a4-4355035226ba","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6f93632b-9e18-4f08-be85-f51a5a87eb32","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6f93632b-9e18-4f08-be85-f51a5a87eb32","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"9638b6d3-03dd-4898-b861-0d857025eb94","$typeOfContent":"text","type":"SendMessage","settings":{"id":"a36c26b8-c5bf-4058-a571-8e0414115ce4","type":"text/plain","content":"A fim de buscar um consultório perto de você, informe seu cep. ","metadata":{}},"$cardContent":{"document":{"id":"a36c26b8-c5bf-4058-a571-8e0414115ce4","type":"text/plain","content":"A fim de buscar um consultório perto de você, informe seu cep. "},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"16957ecb-2a49-46b1-83be-d37b702b7a74","type":"text/plain","textContent":"Entrada do usuário","content":"cep"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"cep","validation":{"rule":"regex","regex":"^[0-9]{8}$","error":"Cep inválido."}},"$invalid":false}],"$conditionOutputs":[{"stateId":"faf92b80-6f55-4f1f-8deb-9cf13ca7b24b","typeOfStateId":"state","$connId":"con_63","$id":"64a83e8e-77b4-4b75-bd5a-fc90c627f90a","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.cep"}],"$invalid":false},{"stateId":"faf92b80-6f55-4f1f-8deb-9cf13ca7b24b","typeOfStateId":"state","$connId":"con_68","$id":"69a91b7d-3c10-408b-aebb-64d7980cd29d","conditions":[{"source":"input","comparison":"exists","values":[]}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"87003dac-8ffc-46f8-9ade-e38bd9974fa0","$typeOfContent":"","type":"MergeContact","$title":"Definir contato","$invalid":false,"settings":{"extras":{"cep":"{{cep}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"f9f808e4-d40b-44f1-a3b0-8aacc53d25cb","root":false,"$title":"Informar CEP","$position":{"top":"481px","left":"210px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"cd9612be-7264-4f80-9275-478b6bbefd0e":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"c003828e-de6d-4791-b24b-469754336a04","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"12928a80-9a65-48d5-bc66-369bcb001f1f","typeOfStateId":"state","$connId":"con_73","$id":"ae29262f-462a-4ba7-b4ac-559295cc3bf0","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"isWorkTime"}],"$invalid":false},{"stateId":"30883e4e-f32a-4214-983e-3b367031c79a","typeOfStateId":"state","$connId":"con_78","$id":"57ccd313-7f0f-416c-a452-30bdca20cdca","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"isWorkTime"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"b2b564d7-4dcc-468a-b7f2-60b13bf51506","$typeOfContent":"","type":"ExecuteScript","$title":"SetWorkSchedule","$invalid":false,"settings":{"function":"run","source":"function run() {\n let workSchedule = [\n    {\n        \"num\": 1,\n        \"name\": \"Monday\",\n        \"portugueseName\": \"Segunda\",\n        \"workTime\": [\n            {\n                \"start\": \"08:30\",\n                \"end\": \"17:30\"\n            }\n        ]\n    },\n    {\n        \"num\": 2,\n        \"name\": \"Tuesday\",\n        \"portugueseName\": \"Terça\",\n        \"workTime\": [\n            {\n                \"start\": \"08:30\",\n                \"end\": \"17:30\"\n            }\n        ]\n    },\n    {\n        \"num\": 3,\n        \"name\": \"Wednesday\",\n        \"portugueseName\": \"Quarta\",\n        \"workTime\": [\n            {\n               \"start\": \"08:30\",\n                \"end\": \"17:30\"\n            }\n        ]\n    },\n    {\n        \"num\": 4,\n        \"name\": \"Thursday\",\n        \"portugueseName\": \"Quinta\",\n        \"workTime\": [\n            {\n                \"start\": \"08:30\",\n                \"end\": \"18:00\"\n            }\n        ]\n    },\n    {\n        \"num\": 5,\n        \"name\": \"Friday\",\n        \"portugueseName\": \"Sexta\",\n        \"workTime\": [\n            {\n                \"start\": \"08:30\",\n                \"end\": \"18:00\"\n            }\n        ]\n    },\n    {\n        \"num\": 6,\n        \"name\": \"Saturday\",\n        \"portugueseName\": \"Sábado\",\n        \"workTime\": [\n            {\n                \"start\": \"08:30\",\n                \"end\": \"12:30\"\n            }\n        ]\n    }\n];\n return JSON.stringify(workSchedule); //Return value will be saved as \"Return value variable\" field name\n }","inputVariables":[],"outputVariable":"workSchedule","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"98b4d78e-d501-41b1-a7c7-7a59064bd1bf","$typeOfContent":"","type":"ExecuteScript","$title":"CheckWorkTime","$invalid":false,"settings":{"function":"run","source":"//v1.2\n// The default offset if the offset has not been set\nconst DEFAULT_OFFSET = -3;\n\n// Receive the variables as parameters\nfunction run(offset, weekSchedule) {\n\n    // offset = !isNaN(parseInt(offset))? parseInt(offset) : DEFAULT_OFFSET;\n    \n    // weekSchedule = JSON.parse(weekSchedule);\n    // let today = nowUTC(offset);\n    // if (isWorkDay(today, weekSchedule)) {\n    //     let todaySchedule = getTodaySchedule(weekSchedule, today);\n    //     let intervalTime = getIntervalTime(todaySchedule, today);\n    //     return checkTime(intervalTime, today);\n    // }\n    return true;\n}\nfunction getIntervalTime(todaySchedule, today) {\n    let intervalTime = [];\n    for (let i = 0; i < todaySchedule.workTime.length; i++) {\n        intervalTime.push({\n            start: utcDate(todaySchedule.workTime[i].start, today),\n            end: utcDate(todaySchedule.workTime[i].end, today)\n        });\n    }\n    return intervalTime;\n}\nfunction checkTime(intervalTime, today) {\n    for (let i = 0; i < intervalTime.length; i++) {\n        if (today - intervalTime[i].start > 0 && intervalTime[i].end - today > 0)\n            return true;\n    }\n    return false;\n}\nfunction getTodaySchedule(weekSchedule, today) {\n    for (let i = 0; i < weekSchedule.length; i++) {\n        if (weekSchedule[i].num == today.getDay()) return weekSchedule[i];\n    }\n}\n//Get now UTC Date\nfunction nowUTC(offset) {\n    let now = new Date();\n    let utc_timestamp = Date.UTC(\n        now.getUTCFullYear(),\n        now.getUTCMonth(),\n        now.getUTCDate(),\n        now.getUTCHours(),\n        now.getUTCMinutes(),\n        now.getUTCSeconds(),\n        now.getUTCMilliseconds()\n    );\n    return new Date(utc_timestamp + offset * 3600 * 1000);\n}\n//Get UTC Date\nfunction utcDate(timeString, today) {\n    let hour = getValueByString(\"hour\", timeString);\n    let minutes = getValueByString(\"minutes\", timeString);\n    let utc_timestamp = Date.UTC(\n        today.getUTCFullYear(),\n        today.getUTCMonth(),\n        today.getUTCDate(),\n        hour,\n        minutes,\n        0,\n        0\n    );\n    return new Date(utc_timestamp);\n}\n//Get hour/minute by string with pattern HH:mm\nfunction getValueByString(type, timeString) {\n    if (type === \"hour\") {\n        return parseInt(timeString.substring(0, timeString.indexOf(\":\")));\n    } else if (type === \"minutes\") {\n        return parseInt(\n            timeString.substring(timeString.indexOf(\":\") + 1, timeString.length)\n        );\n    }\n    return 0;\n}\n//Get if today is a work day\nfunction isWorkDay(today, workDays) {\n    for (let i = 0; i < workDays.length; i++) {\n        if (workDays[i].num == today.getDay().toString()) return true;\n    }\n    return false;\n}","inputVariables":["config.dateTimeOffset","workSchedule"],"outputVariable":"isWorkTime","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"3f06934f-7ac4-442d-8ae8-a67792b232c8","$typeOfContent":"","type":"TrackEvent","$title":"opcao2","$invalid":false,"settings":{"extras":{},"category":"listaOpcoes","action":"opcao2"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"cd9612be-7264-4f80-9275-478b6bbefd0e","root":false,"$title":"Horário de atendimento","$position":{"top":"430px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"12928a80-9a65-48d5-bc66-369bcb001f1f":{"$contentActions":[{"action":{"$id":"6c3a78c2-e550-4d17-bdcb-3fa6c5fb1286","$typeOfContent":"text","type":"SendMessage","settings":{"id":"eff627dd-d2a0-49bc-9f90-747a3ecbc318","type":"text/plain","content":"{{message}}","metadata":{}},"$cardContent":{"document":{"id":"eff627dd-d2a0-49bc-9f90-747a3ecbc318","type":"text/plain","content":"{{message}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"37fdf625-387a-4756-af6f-53f9067080e5","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"d75f44cb-7a3c-4567-81c6-a4508e4d200d","$typeOfContent":"","type":"TrackEvent","$title":"TrackRequestsOutWorkTime","$invalid":false,"settings":{"extras":{},"category":"Solicitação","action":"Fora Horario Atendimento"},"conditions":[]},{"$id":"281c760e-d648-421f-aeb8-07b0e166f88a","$typeOfContent":"","type":"ExecuteScript","$title":"BuildMessage","$invalid":false,"settings":{"function":"run","source":"/**\n            * All input variables needs to be passed as function param;\n            * Objects received as param needs to be parsed. Ex.: JSON.parse(inputVariable1);\n            * Objects returned needs to be stringfied. Ex.: JSON.stringify(inputVariable1);\n            **/\nvar DEFAULT_MESSAGE = \"Infelizmente, não realizamos atendimento hoje.\";\n\nfunction run(workSchedule, day) {\n    workSchedule = JSON.parse(workSchedule);\n    let today = getToday(workSchedule, day);\n    return checkToday(today); //Return value will be saved as \"Return value variable\" field name\n}\n\n\nfunction getToday(workSchedule, day) {\n    let today = workSchedule.filter(e => {\n        return e.name === day;\n    });\n    return today;\n}\n\nfunction checkToday(today) {\n    if (today.length > 0) return buildMessage(today[0]);\n    else return DEFAULT_MESSAGE;\n}\n\nfunction buildMessage(today) {\n    let patternMessage =\n        \"Infelizmente não estamos no nosso horário de atendimento. \" +\n        today.portugueseName +\n        \" nosso horário de atendimento é de \";\n\n    today.workTime.forEach(e => {\n        patternMessage += e.start + \" a \" + e.end + \", \";\n    });\n\n    patternMessage += \"por gentileza, retorne neste horário.\";\n    return patternMessage;\n}\n","inputVariables":["workSchedule","calendar.dayOfWeek"],"outputVariable":"message","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"cd9612be-7264-4f80-9275-478b6bbefd0e","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"12928a80-9a65-48d5-bc66-369bcb001f1f","root":false,"$title":"Fora do atendimento","$position":{"top":"441px","left":"992px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"30883e4e-f32a-4214-983e-3b367031c79a":{"$contentActions":[{"input":{"bypass":true,"$cardContent":{"document":{"id":"8b15a422-cea7-44b7-84c9-7ffe4f13a52e","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"13701081-2d57-48f7-914d-66fb22f5c700","typeOfStateId":"state","$connId":"con_83","$id":"786703cf-0e5d-4394-a226-dd130a0c8f54","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"hasAttendant"}],"$invalid":false},{"stateId":"b0f04a31-8fc7-4a6e-97a2-e9d19dd046a9","typeOfStateId":"state","$connId":"con_88","$id":"9b5b7742-154b-4ad3-9f1c-75c961791879","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"hasAttendant"}],"$invalid":false}],"$enteringCustomActions":[{"$id":"4192ec9e-db2e-4072-b55c-2e0ea13f65ce","$typeOfContent":"","type":"ProcessHttp","$title":"CheckAgentsAvailability","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key Y29uc3VsdG9yaW9tZWRpY28yOnIxQzVxcUFLakVOQnFTYU5wak5L"},"method":"POST","body":"\n{\n  \"id\": \"{{random.guid}}\",\n  \"from\": \"{{application.identifier}}@{{application.domain}}\",  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/attendants\"\n}","uri":"https://http.msging.net/commands","responseStatusVariable":"status","responseBodyVariable":"result"},"conditions":[]},{"$id":"054c92c5-ec0d-41b6-884f-098366ee4f25","$typeOfContent":"","type":"ExecuteScript","$title":"HandleCheckRequest","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(result) {\n\n    result = JSON.parse(result);\n    let hasAttendant = false;\n    \n    if(result.resource && result.resource.total >= 1){\n            hasAttendant = result.resource.items.some(function(attendant){\n                return attendant.status === 'Online';\n            });\n    }\n\n    return hasAttendant;\n}","inputVariables":["result"],"outputVariable":"hasAttendant","LocalTimeZoneEnabled":false},"conditions":[]},{"$id":"8f7bbd2b-3fcb-4047-b786-e0d139962ed6","$typeOfContent":"","type":"TrackEvent","$title":"HorarioAtendimento","$invalid":false,"settings":{"extras":{},"action":"{{calendar.time}}","category":"HorarioAtendimento"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"30883e4e-f32a-4214-983e-3b367031c79a","root":false,"$title":"Disponibilidade de atendentes","$position":{"top":"608px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"90f26382-c363-46f6-ae99-cc088d084c47":{"$contentActions":[{"action":{"$id":"c59ab500-0af3-4f4f-bd38-cf899ef0a0c7","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"69a8a26a-b624-4bb0-afec-ddb03a8b5bb5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"69a8a26a-b624-4bb0-afec-ddb03a8b5bb5","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"f7db244d-ad87-464a-af6a-49170d562c2f","$typeOfContent":"text","type":"SendMessage","settings":{"id":"2bfa8c7e-77c5-42a8-94db-8100acf4e9aa","type":"text/plain","content":"{{input.contentAssistant.result}}","metadata":{}},"$cardContent":{"document":{"id":"2bfa8c7e-77c5-42a8-94db-8100acf4e9aa","type":"text/plain","content":"{{input.contentAssistant.result}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"29f5efbe-5146-4283-9fd6-ce783c06ec57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"00e55d1d-353e-45fc-871c-224815d5e0ec","$typeOfContent":"","type":"TrackEvent","$title":"Registro de eventos","$invalid":false,"settings":{"extras":{},"category":"listaOpcoes","action":"opcao3"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"90f26382-c363-46f6-ae99-cc088d084c47","root":false,"$title":"Médicos especialiazados","$position":{"top":"263px","left":"989px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"b0f04a31-8fc7-4a6e-97a2-e9d19dd046a9":{"$contentActions":[{"action":{"$id":"265e08b2-351e-42ba-aaef-21845c867780","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d02306f9-1ca1-4448-a795-775cc93dc734","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d02306f9-1ca1-4448-a795-775cc93dc734","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b64bc230-7278-4882-a59a-a6bdcc4dd97a","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f6d136af-6f03-4637-b2f4-e3c7f7acd536","type":"text/plain","content":"Desculpe, não temos atendentes disponíveis no momento. Por favor, tente novamente mais tarde.","metadata":{}},"$cardContent":{"document":{"id":"f6d136af-6f03-4637-b2f4-e3c7f7acd536","type":"text/plain","content":"Desculpe, não temos atendentes disponíveis no momento. Por favor, tente novamente mais tarde."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"dc6440a7-7ea8-4bf7-8375-d478cc520c57","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"1f92c3ef-6ea0-406a-b347-491256eb9d97","$typeOfContent":"","type":"TrackEvent","$title":"TrackRequestsWithoutAgent","$invalid":false,"settings":{"extras":{},"category":"Solicitação","action":"Sem Atendente"},"conditions":[]},{"$id":"0535da88-95d7-422c-993b-2bfda6ee9839","$typeOfContent":"","type":"TrackEvent","$title":"TrackAbsoLuteNotAvailbleAgents","$invalid":false,"settings":{"extras":{},"category":"Atendentes Indisponíveis","action":"Atendentes Indisponíveis"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"cd9612be-7264-4f80-9275-478b6bbefd0e","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"b0f04a31-8fc7-4a6e-97a2-e9d19dd046a9","root":false,"$title":"Nenhum atendente disponível","$position":{"top":"771px","left":"644px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"13701081-2d57-48f7-914d-66fb22f5c700":{"$contentActions":[{"action":{"$id":"92ab77a6-ce27-4c5c-86ba-c38487ee6c65","$typeOfContent":"text","type":"SendMessage","settings":{"id":"54be5f2f-e167-41fd-b780-dc2f54fe32c0","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respondê-lo.","metadata":{}},"$cardContent":{"document":{"id":"54be5f2f-e167-41fd-b780-dc2f54fe32c0","type":"text/plain","content":"A partir de agora um de nossos atendentes vai respondê-lo."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"60ab1a1e-9db8-4057-9685-9d8db8f4fd1e","$typeOfContent":"text","type":"SendMessage","settings":{"id":"1647bc53-4e34-4641-a9bf-f5abea050d44","type":"text/plain","content":"{{queueText}}","metadata":{}},"$cardContent":{"document":{"id":"1647bc53-4e34-4641-a9bf-f5abea050d44","type":"text/plain","content":"{{queueText}}"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"458325af-4611-47de-ab61-424014b684e6","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8ebd6193-3154-4fdb-8f25-c6c29922decc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8ebd6193-3154-4fdb-8f25-c6c29922decc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"027ef726-61b5-4573-b3eb-21b42aaec694","$typeOfContent":"text","type":"SendMessage","settings":{"id":"8d336f3b-643c-4c8a-98a6-dcfe133e3563","type":"text/plain","content":"Como podemos ajudá-lo?","metadata":{}},"$cardContent":{"document":{"id":"8d336f3b-643c-4c8a-98a6-dcfe133e3563","type":"text/plain","content":"Como podemos ajudá-lo?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"dd2d5697-9c96-4158-a0af-9d2b73e38762","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"stateId":"desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6","typeOfStateId":"state","$connId":"con_93","$id":"f8ee3637-7911-41cc-ac8a-519142b4f203","conditions":[{"source":"input","comparison":"matches","values":[".  *"]}],"$invalid":false}],"$enteringCustomActions":[{"$id":"8a479c88-5e20-48e1-a255-70680c2be9cd","$typeOfContent":"","type":"TrackEvent","$title":"TrackAttendances","$invalid":false,"settings":{"extras":{},"category":"AtendimentosRealizados","action":"AtendimentosRealizados"},"conditions":[]},{"$id":"2ff593f9-27e3-4ad5-bbc1-7fff4a01f6a8","$typeOfContent":"","type":"ProcessHttp","$title":"getTicketsMetrics","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key Y29uc3VsdG9yaW9tZWRpY28yOnIxQzVxcUFLakVOQnFTYU5wak5L"},"method":"POST","body":"{\n  \"id\": \"{{$guid}}\",\n  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/monitoring/ticket-metrics?version=2\"\n}","uri":"https://http.msging.net/commands","responseBodyVariable":"getTicketsMetrics","responseStatusVariable":"status"},"conditions":[]},{"$id":"a05545d3-9930-4d7d-b5d1-76c934a72af6","$typeOfContent":"","type":"ProcessHttp","$title":"getWaitingTicketsMetrics","$invalid":false,"settings":{"headers":{"Content-Type":"application/json","Authorization":"Key Y29uc3VsdG9yaW9tZWRpY28yOnIxQzVxcUFLakVOQnFTYU5wak5L"},"method":"POST","body":"{\n  \"id\": \"{{random.guid}}\",\n  \"to\": \"postmaster@desk.msging.net\",\n  \"method\": \"get\",\n  \"uri\": \"/monitoring/waiting-tickets?version=2\"\n}","uri":"https://http.msging.net/commands","responseStatusVariable":"status","responseBodyVariable":"getWaitingTicketsMetrics"},"conditions":[]},{"$id":"5a4a55d4-e36e-4fea-8b79-6621d09f4c95","$typeOfContent":"","type":"ExecuteScript","$title":"tratamento da fila","$invalid":false,"settings":{"function":"run","source":"function run(getTicketsMetrics, getWaitingTicketsMetrics) {\n\n    var metric = JSON.parse(getTicketsMetrics);\n\n    var queue = queuePos(getWaitingTicketsMetrics);\n\t\n    if (queue == 1) {\n        var queueText = \"Sua posição na fila é: \" + queue + \".\";\n        return queueText; \n    } else {\n        var waitTime = metric.resource.avgWaitTime; //\"00:02:41.333333\"; //\n        var queueText = \"Sua posição na fila é: \" + queue + \".\\n Tempo médio de espera: \" + waitTime.split(\".\")[0];\n        return queueText;\n    }\n}\n\nfunction queuePos(getWaitingTicketsMetrics) {\n  \n  var queue = JSON.parse(getWaitingTicketsMetrics);\n  var queueCount = queue.resource.total;\n  \n  if (queueCount === undefined) {\n      queueCount = 1;\n      return queueCount; \n  } else {\n      queueCount = queueCount + 1;\n      return queueCount;\n  }\n}","inputVariables":["getTicketsMetrics","getWaitingTicketsMetrics"],"outputVariable":"queueText","LocalTimeZoneEnabled":false},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"13701081-2d57-48f7-914d-66fb22f5c700","root":false,"$title":"Atendente disponível","$position":{"top":"758px","left":"909px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6":{"$contentActions":[{"input":{"bypass":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"$cardContent":{"document":{"id":"beafeb2f-6954-4c1c-82aa-6a81b63d6749","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant"]}],"$invalid":false,"stateId":"e300547a-4ccf-4a93-ad9e-01e624bb6967","$connId":"con_98","$id":"fee546c8-4860-472a-a35c-67942bf1b090"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClient"]}],"$invalid":false,"stateId":"e300547a-4ccf-4a93-ad9e-01e624bb6967","$connId":"con_103","$id":"e1265fb1-d492-423c-ba03-ddb8eb4ddbe3"},{"$isDeskOutput":true,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedClientInactivity"]}],"$invalid":false,"stateId":"e300547a-4ccf-4a93-ad9e-01e624bb6967","$connId":"con_108","$id":"900821e3-2249-4d1c-95f8-85358ff5c591"}],"$enteringCustomActions":[{"$id":"0a0d7a38-8042-4196-9156-a0dd2801acb6","$typeOfContent":"","type":"ExecuteScript","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"function":"run","source":"function run(contact, tunnel_identity) {\n    contact = JSON.parse(contact);\n    contact.identity = tunnel_identity;\n    return contact;\n}","inputVariables":["contact.serialized","tunnel.identity"],"outputVariable":"deskUpdateTunnelContactBody","LocalTimeZoneEnabled":false}},{"$id":"f2597b48-98c1-48da-a6e2-4f9450d83f2f","$typeOfContent":"","type":"ProcessCommand","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6"]},{"source":"context","variable":"tunnel.identity","comparison":"exists","values":[]}],"settings":{"to":"postmaster@msging.net","from":"{{application.identity}}","method":"merge","uri":"/contacts","type":"application/vnd.lime.contact+json","resource":"{{deskUpdateTunnelContactBody}}","variable":"mergeRouterContactWithTunnelCommandResponse"}},{"$id":"b91a87ec-517d-452a-b9db-b7c9581e12d5","$typeOfContent":"","type":"ExecuteScript","$title":"GetEncodedContactIdentity","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6"]}],"settings":{"function":"run","source":"function run(identity) {\n return (identity !== undefined) ? encodeURIComponent(identity) : identity;\n}","inputVariables":["input.message.fromidentity"],"outputVariable":"helpDeskEncodedFromIdentity","LocalTimeZoneEnabled":false}},{"$id":"c0b5a950-bff8-4a7d-8571-e0e5466cf4b7","$typeOfContent":"","type":"ProcessCommand","$title":"GetOpenTicket","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"get","uri":"/tickets?$filter=customerIdentity%20eq%20%27{{helpDeskEncodedFromIdentity}}%27%20and%20%28status%20eq%20%27Open%27%20or%20status%20eq%20%27Waiting%27%20or%20status%20eq%20%27Assigned%27%29","metadata":{"server.shouldStore":true},"variable":"helpDeskGetOpenTicketCommandResponse"}},{"$id":"97178e0a-98e1-4bfb-aca0-e1dffc526690","$typeOfContent":"","type":"ExecuteScript","$title":"TreatGetOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"state.previous.id","comparison":"notEquals","values":["desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = JSON.parse(commandResponse)\n    var ticketExists = (response && response.resource && response.resource.items && response.resource.items.length > 0);\n  return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskGetOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"3034b4b5-319b-44b3-928b-7f85b2afffb8","$typeOfContent":"","type":"ProcessCommand","$title":"OpenTicketIfNotFound","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"from":"{{application.identifier}}@{{application.domain}}","to":"postmaster@desk.msging.net","method":"set","uri":"/tickets/{{helpDeskEncodedFromIdentity}}","variable":"helpDeskOpenTicketCommandResponse","type":"text/plain","resource":"{{input.content}}","metadata":{"server.shouldStore":true}}},{"$id":"a277191d-b89f-4743-9b66-067b478ce589","$typeOfContent":"","type":"ExecuteScript","$title":"TreatOpenTicketResponse","$invalid":false,"conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"notEquals","values":["true"]}],"settings":{"function":"run","source":"function run(commandResponse) {\n    var response = commandResponse ? JSON.parse(commandResponse) : {}\n    var ticketExists = response && response.type === \"application/vnd.iris.ticket+json\" && response.resource \n    return ticketExists ? \"true\" : \"false\";\n}","inputVariables":["helpDeskOpenTicketCommandResponse"],"outputVariable":"helpDeskHasTicket","LocalTimeZoneEnabled":false}},{"$id":"c3e95cd5-fb5b-4bbd-8b20-66bcc3d11703","$typeOfContent":"","type":"ForwardMessageToDesk","conditions":[{"source":"context","variable":"helpDeskHasTicket","comparison":"equals","values":["true"]}],"settings":{},"$invalid":false}],"$leavingCustomActions":[{"$id":"8eb9c135-0457-47e4-b170-8ebcecbeb585","$typeOfContent":"","type":"SetVariable","$title":"ResetHasTicket","$invalid":false,"conditions":[{"source":"context","variable":"input.type","comparison":"equals","values":["application/vnd.iris.ticket+json"]},{"source":"context","variable":"input.content@status","comparison":"equals","values":["ClosedAttendant","ClosedClient","ClosedClientInactivity"]}],"settings":{"variable":"helpDeskHasTicket","value":"false","$invalid":false}}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6","$invalid":false},"$tags":[],"id":"desk:e3c4dceb-2d4b-44e7-86bd-d529d19e6ba6","deskStateVersion":"2.00","root":false,"$title":"Atendimento humano","$position":{"top":"874px","left":"909px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"2836d1f2-aee3-4495-8693-9c2746804d21":{"$contentActions":[{"action":{"$id":"583bc190-2cf2-43da-a228-e51344b69229","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"8253aad0-c3fd-4bc8-9e5f-900e1307791e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"8253aad0-c3fd-4bc8-9e5f-900e1307791e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"5144c3c6-0b53-480f-8214-dfe2b3c652f6","$typeOfContent":"text","type":"SendMessage","settings":{"id":"daa83e1d-5b5f-4423-8b39-14b097ee434f","type":"text/plain","content":"Atendimento finalizado!","metadata":{}},"$cardContent":{"document":{"id":"daa83e1d-5b5f-4423-8b39-14b097ee434f","type":"text/plain","content":"Atendimento finalizado!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"3d6879aa-b29e-4ccf-8702-01235c1d576c","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"345d8ccc-bd2f-4937-aa1f-9def78eb5099","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"345d8ccc-bd2f-4937-aa1f-9def78eb5099","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"ffcd6b91-35b4-4675-a626-9a2a01d6cf36","$typeOfContent":"text","type":"SendMessage","settings":{"id":"e1eb2094-3777-4d7a-ace8-45291beed54c","type":"text/plain","content":"Em uma escala de 0 a 5, onde 0 é nada satisfeito e 5 é totalmente satisfeito, qual nota você dá para esse atendimento?","metadata":{}},"$cardContent":{"document":{"id":"e1eb2094-3777-4d7a-ace8-45291beed54c","type":"text/plain","content":"Em uma escala de 0 a 5, onde 0 é nada satisfeito e 5 é totalmente satisfeito, qual nota você dá para esse atendimento?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"3fb14900-c1ba-4e0a-92a6-9545c1862339","type":"text/plain","textContent":"Entrada do usuário","content":"score"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"score","validation":{"rule":"regex","error":"Nota de avaliação inválida","regex":"^[0-5]{1}$"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"328cfbc2-d59d-425c-80da-6659e0e1aeec","typeOfStateId":"state","$connId":"con_113","$id":"2ad8dd75-3791-4dfd-a0cb-03be8aefd7af","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"score"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"ed6a9e52-16b0-4b46-b5af-5945cccdc642","$typeOfContent":"","type":"TrackEvent","$title":"TrackScoreValue","$invalid":false,"settings":{"extras":{},"category":"Score","action":"{{score}}"},"conditions":[]},{"$id":"da9df380-f30f-4915-92a7-5a4c9d724151","$typeOfContent":"","type":"ExecuteScript","$title":"NormalizeScore","$invalid":false,"settings":{"function":"run","source":"// Receive the variables as parameters\nfunction run(score) {\n    if(isNumeric(score)){\n       score = parseInt(score);\n       if(score < 0) return 0;\n       if(score > 10) return 10;\n       return score;\n    }\n    return \"Outro\";\n}\n\n//check if a string has a number\nfunction isNumeric(num){\n  return !isNaN(num)\n}","inputVariables":["score"],"outputVariable":"score"},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"2836d1f2-aee3-4495-8693-9c2746804d21","root":false,"$title":"Nota de atendimento","$position":{"top":"1122px","left":"910px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"92e034eb-9420-47ad-a10d-42519dffb045":{"$contentActions":[{"action":{"$id":"d7e6aa63-eb43-401d-a2b7-9c59e77641a8","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"e96a5e4a-23a2-4ba8-b2dd-ba1b75a5a91f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"e96a5e4a-23a2-4ba8-b2dd-ba1b75a5a91f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"b5ca521f-0b23-4bc0-bb18-23fe95e57eb3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"7ee41ff8-d297-45a9-a03f-d0b073aa7e88","type":"text/plain","content":"Qual melhor data para seu agendamento ?","metadata":{}},"$cardContent":{"document":{"id":"7ee41ff8-d297-45a9-a03f-d0b073aa7e88","type":"text/plain","content":"Qual melhor data para seu agendamento ?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"93f621c1-4105-4c8a-ae9f-6ef4cc095362","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"6b845901-5c92-4360-8152-d721f3bca5f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"6b845901-5c92-4360-8152-d721f3bca5f3","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"54f1a6ed-1acd-473f-8bf0-4dae138f0dc3","$typeOfContent":"text","type":"SendMessage","settings":{"id":"1f6e6112-76ca-4283-8346-15c43236c42b","type":"text/plain","content":"Digite seguindo o seguinte ex: 00/00/0000","metadata":{}},"$cardContent":{"document":{"id":"1f6e6112-76ca-4283-8346-15c43236c42b","type":"text/plain","content":"Digite seguindo o seguinte ex: 00/00/0000"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"3001c4f6-6a7c-4188-bc02-76bd9d027f63","type":"text/plain","textContent":"Entrada do usuário","content":"date"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"date","validation":{"rule":"date","error":"Isso não é uma data. Informe alguma data válida"}},"$invalid":false}],"$conditionOutputs":[{"stateId":"625969fb-6f92-4800-9bfa-808cb3efccbf","typeOfStateId":"state","$connId":"con_118","$id":"fd6b8e37-6f3f-4292-9dcf-904b27a2a660","conditions":[{"source":"context","comparison":"equals","values":["false"],"variable":"dateAtualizado"}],"$invalid":false},{"stateId":"d2e4b58f-d7ee-44d3-849e-0683ea127f1e","typeOfStateId":"state","$connId":"con_123","$id":"4b9dd968-a77e-4a80-8b5a-6b2db9bab41e","conditions":[{"source":"context","comparison":"equals","values":["true"],"variable":"dateAtualizado"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"229d6522-3a5d-4dc9-9ad2-376f9bf568e2","$typeOfContent":"","type":"ExecuteScript","$title":"Executar script","$invalid":false,"settings":{"function":"run","source":"\nfunction run(requestedDate) {\n\n\n//   var date1 = \"{{date}}\"\n\n  requestedDate = requestedDate.split(\"/\");\n  var requestedDate = new Date( requestedDate[2], requestedDate[1] - 1, requestedDate[0]);\n\n  if (requestedDate > + new Date()) \n    return true; \n  return false;\n}\n","inputVariables":["date"],"outputVariable":"dateAtualizado"},"conditions":[]},{"$id":"472e0df6-ced6-48f2-887d-cde6afd05ebf","$typeOfContent":"","type":"MergeContact","$title":"Definir Data","$invalid":false,"settings":{"extras":{"data":"{{date}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"92e034eb-9420-47ad-a10d-42519dffb045","root":false,"$title":"Perguntar a Data","$position":{"top":"794px","left":"185px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"d2e4b58f-d7ee-44d3-849e-0683ea127f1e":{"$contentActions":[{"action":{"$id":"131b31c5-ae13-45d3-afff-cabbc1cfa180","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"47d0049f-c870-45af-8910-00b33164ea3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"47d0049f-c870-45af-8910-00b33164ea3f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"24e6c6af-7781-4283-b3cf-1120135da689","$typeOfContent":"text","type":"SendMessage","settings":{"id":"f631962d-c458-4eb1-b164-302417aafedc","type":"text/plain","content":"Qual horário de preferência?","metadata":{}},"$cardContent":{"document":{"id":"f631962d-c458-4eb1-b164-302417aafedc","type":"text/plain","content":"Qual horário de preferência?"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"4e9071e4-e4fb-4a4d-a732-6c9e981174e2","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d1f92705-5527-43d3-acb9-5e1589c2307f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d1f92705-5527-43d3-acb9-5e1589c2307f","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"75bf3e03-c90f-4c7f-ba4f-d13d7ad2e1c1","$typeOfContent":"text","type":"SendMessage","settings":{"id":"599c2310-57dd-4a6a-ae1b-4f7594f31e70","type":"text/plain","content":"Os horários são entre 7:00h às 17:00h","metadata":{}},"$cardContent":{"document":{"id":"599c2310-57dd-4a6a-ae1b-4f7594f31e70","type":"text/plain","content":"Os horários são entre 7:00h às 17:00h"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"2829b8f5-502c-4676-8923-153920165d4d","$typeOfContent":"text","type":"SendMessage","settings":{"id":"cf54be1e-a2a6-406e-b9ec-6a677a31e1ca","type":"text/plain","content":"Digite somente números no horário de preferência.","metadata":{}},"$cardContent":{"document":{"id":"cf54be1e-a2a6-406e-b9ec-6a677a31e1ca","type":"text/plain","content":"Digite somente números no horário de preferência."},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":false,"$cardContent":{"document":{"id":"e52a5203-722a-4fd3-91a3-f5b7d37497b8","type":"text/plain","textContent":"Entrada do usuário","content":"time"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false,"variable":"time","validation":{"rule":"number","error":"Isso não é um número."}},"$invalid":false}],"$conditionOutputs":[{"stateId":"b39ed2ce-c621-4fa0-b30c-0d885ac4e551","typeOfStateId":"state","$connId":"con_128","$id":"4e996f6f-733d-4167-83a8-edbf7c79751f","conditions":[{"source":"context","comparison":"greaterThanOrEquals","values":["7"],"variable":"time"},{"source":"context","comparison":"lessThanOrEquals","values":["17"],"variable":"time"}],"$invalid":false},{"stateId":"b39ed2ce-c621-4fa0-b30c-0d885ac4e551","typeOfStateId":"state","$connId":"con_133","$id":"3ee5224f-3d3c-4df3-ba49-ac517e61c283","conditions":[{"source":"context","comparison":"exists","values":[],"variable":"contact.time"}],"$invalid":false}],"$enteringCustomActions":[],"$leavingCustomActions":[{"$id":"65f1bf0d-e7b3-46f4-99e4-45d91ee12b3c","$typeOfContent":"","type":"MergeContact","$title":"Definir contato HORA","$invalid":false,"settings":{"extras":{"hora":"{{time}}"}},"conditions":[]}],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"d2e4b58f-d7ee-44d3-849e-0683ea127f1e","root":false,"$title":"Perguntar a Hora","$position":{"top":"920px","left":"433px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"e300547a-4ccf-4a93-ad9e-01e624bb6967":{"$contentActions":[{"input":{"bypass":false,"$cardContent":{"document":{"id":"d0146ff5-0d28-4ef1-834a-e1f83c123b6f","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[{"$id":"6ec64608-bfd2-46a0-a72a-4a80a90edda6","$typeOfContent":"","type":"TrackEvent","$title":"ID","$invalid":false,"settings":{"extras":{},"category":"ID","action":"{{input.content@sequentialId}}"},"conditions":[]},{"$id":"c44896cc-37b5-4bfc-8923-adf711241a6f","$typeOfContent":"","type":"TrackEvent","$title":"Agente","$invalid":false,"settings":{"extras":{},"category":"Agente","action":"{{input.content@agentIdentity}}"},"conditions":[]}],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"2836d1f2-aee3-4495-8693-9c2746804d21","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"e300547a-4ccf-4a93-ad9e-01e624bb6967","root":false,"$title":"Bloco X","$position":{"top":"1009px","left":"909px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"328cfbc2-d59d-425c-80da-6659e0e1aeec":{"$contentActions":[{"action":{"$id":"20dabdc7-d8a6-451f-87ac-351be1a6c97a","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"dfeaf9b7-0978-4c48-acc2-e99bb3b8f76e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"dfeaf9b7-0978-4c48-acc2-e99bb3b8f76e","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"c5cbeade-b5d0-40fd-b0f4-c58d6e6ffbad","$typeOfContent":"text","type":"SendMessage","settings":{"id":"466d4e9c-7c58-4f3b-a775-af7ee0681c86","type":"text/plain","content":"Obrigado pela sua nota de avaliação!","metadata":{}},"$cardContent":{"document":{"id":"466d4e9c-7c58-4f3b-a775-af7ee0681c86","type":"text/plain","content":"Obrigado pela sua nota de avaliação!"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"92eae892-c6b9-41dc-896e-98244595a971","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"onboarding","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"328cfbc2-d59d-425c-80da-6659e0e1aeec","root":false,"$title":"Finalizar atendimento humano","$position":{"top":"1244px","left":"910px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false},"625969fb-6f92-4800-9bfa-808cb3efccbf":{"$contentActions":[{"action":{"$id":"4de9b24d-bfa4-447f-ac7b-9eaecb739193","$typeOfContent":"chat-state","type":"SendMessage","settings":{"id":"d5a06233-f903-45be-ba37-b1dc8364a8fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"$cardContent":{"document":{"id":"d5a06233-f903-45be-ba37-b1dc8364a8fc","type":"application/vnd.lime.chatstate+json","content":{"state":"composing","interval":1000}},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"action":{"$id":"de50ce95-b066-4f1f-a665-d12923b9398b","$typeOfContent":"text","type":"SendMessage","settings":{"id":"45d9bca6-a375-4d19-8b92-bf6969c8efdd","type":"text/plain","content":"Data inválida. Digite uma data a partir da de hoje ({{calendar.day}}/0{{calendar.month}}/{{calendar.year}})","metadata":{}},"$cardContent":{"document":{"id":"45d9bca6-a375-4d19-8b92-bf6969c8efdd","type":"text/plain","content":"Data inválida. Digite uma data a partir da de hoje ({{calendar.day}}/0{{calendar.month}}/{{calendar.year}})"},"editable":true,"deletable":true,"position":"left"}},"$invalid":false},{"input":{"bypass":true,"$cardContent":{"document":{"id":"a0293980-2095-4d81-b9bb-14f2add67435","type":"text/plain","textContent":"Entrada do usuário","content":"Entrada do usuário"},"editable":false,"deletable":true,"position":"right","editing":false},"$invalid":false},"$invalid":false}],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"92e034eb-9420-47ad-a10d-42519dffb045","$invalid":false,"typeOfStateId":"state"},"$tags":[],"id":"625969fb-6f92-4800-9bfa-808cb3efccbf","root":false,"$title":"Data inválida","$position":{"top":"917px","left":"185px"},"$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}},"globalActions":{"$contentActions":[],"$conditionOutputs":[],"$enteringCustomActions":[],"$leavingCustomActions":[],"$inputSuggestions":[],"$defaultOutput":{"stateId":"fallback","$invalid":false},"$tags":[],"id":"global-actions","$invalidContentActions":false,"$invalidOutputs":false,"$invalidCustomActions":false,"$invalid":false}}